<%- include('../partials/header', { title: 'Customers' }) %>

<div class="flex justify-between items-center mb-4">
  <h1 class="text-2xl font-bold">Customers</h1>
  <a href="/customers/add" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Add Customer</a>
</div>

<div class="overflow-x-auto">
  <table class="w-full bg-white shadow rounded">
    <thead>
      <tr class="bg-gray-200">
        <th class="p-2 text-left">Name</th>
        <th class="p-2 text-left">Email</th>
        <th class="p-2 text-left">Phone</th>
        <th class="p-2 text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if(customers.length > 0) { %>
        <% customers.forEach(c => { %>
          <tr id="customer-<%= c.id %>" class="border-b hover:bg-gray-50">
            <td class="p-2"><%= c.c_name || 'N/A' %></td>
            <td class="p-2"><%= c.Email || 'N/A' %></td>
            <td class="p-2"><%= c.phone_no || 'N/A' %></td>
            <td class="p-2 text-center space-x-3">
              <a href="/customers/edit/<%= c.id %>" class="text-blue-600 hover:text-blue-800 text-xl" title="Edit">
                &#9998;
              </a>
              <button class="text-red-600 hover:text-red-800 delete-customer text-xl" data-id="<%= c.id %>" title="Delete">
                &#128465;
              </button>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="4" class="text-center text-gray-500 py-4">No customers found.</td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>

<script>
  document.querySelectorAll('.delete-customer').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const customerId = e.currentTarget.dataset.id;
      if (!confirm('Are you sure you want to delete this customer?')) return;

      try {
        const response = await fetch(`/customers/delete/${customerId}`, { method: 'DELETE' });
        if (response.ok) {
          document.getElementById(`customer-${customerId}`).remove();
        } else {
          alert('Failed to delete.');
        }
      } catch (err) {
        console.error(err);
      }
    });
  });
</script>

<%- include('../partials/footer') %>
