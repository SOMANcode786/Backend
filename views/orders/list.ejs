<%- include('../partials/header', { title: 'Orders List' }) %>

<div class="flex justify-between items-center mb-4">
  <h1 class="text-2xl font-bold">Orders Management</h1>
  <span class="badge bg-primary fs-6"><%= orders.length %> Total Orders</span>
</div>

<div class="overflow-x-auto">
  <table class="w-full bg-white shadow rounded">
    <thead>
      <tr class="bg-gray-200 text-left">
        <th class="p-2">#ID</th>
        <th class="p-2">Customer</th>
        <th class="p-2">Total Amount</th>
        <th class="p-2">Status</th>
        <th class="p-2">Date</th>
        <th class="p-2 text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if(orders.length > 0) { %>
        <% orders.forEach(order => { %>
          <tr id="order-<%= order.Order_id %>" class="border-b hover:bg-gray-50">
            <td class="p-2 fw-bold text-primary">#<%= order.Order_id %></td>
            <td class="p-2">
              <%= order.c_name || 'N/A' %><br>
              <% if(order.phone_no){ %>
                <small class="text-muted"><%= order.phone_no %></small>
              <% } %>
            </td>
            <td class="p-2 fw-bold text-success">$<%= parseFloat(order.total_amount).toFixed(2) %></td>
            <td class="p-2">
              <span class="badge 
                <% if(order.Order_Status === 'Pending') { %>bg-warning text-dark<% } 
                else if(order.Order_Status === 'Delivered') { %>bg-success<% } 
                else if(order.Order_Status === 'Cancelled') { %>bg-danger<% } 
                else { %>bg-secondary<% } %>">
                <%= order.Order_Status %>
              </span>
            </td>
            <td class="p-2"><%= new Date(order.Order_Date).toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }) %></td>
            <td class="p-2 text-center space-x-3">
              <a href="/orders/view/<%= order.Order_id %>" class="text-blue-600 hover:text-blue-800 text-xl" title="View">&#128065;</a>
              <a href="/orders/edit/<%= order.Order_id %>" class="text-yellow-600 hover:text-yellow-800 text-xl" title="Edit">&#9998;</a>
              <button class="text-red-600 hover:text-red-800 delete-order text-xl" data-id="<%= order.Order_id %>" title="Delete">&#128465;</button>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="6" class="text-center text-gray-500 py-4">No orders found.</td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>

<script>
  document.querySelectorAll('.delete-order').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const orderId = e.currentTarget.dataset.id;
      if (!confirm('Are you sure you want to delete this order?')) return;

      try {
        const response = await fetch(`/orders/delete/${orderId}`, { method: 'DELETE' });
        if (response.ok) {
          document.getElementById(`order-${orderId}`).remove();
        } else {
          alert('Failed to delete order.');
        }
      } catch (err) {
        console.error(err);
      }
    });
  });
</script>

<%- include('../partials/footer') %>
